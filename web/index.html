<!doctype html>
<html lang="es">
	<head>
		<script src="./coi-serviceworker.js"></script>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<script src="https://cdn.tailwindcss.com"></script>
		<title>Image processing engine</title>
	</head>

	<body class="h-dvh flex flex-col bg-zinc-950 text-zinc-100">
		<header
			class="sticky top-0 z-10 border-b border-zinc-800 bg-zinc-950/80 backdrop-blur"
		>
			<div
				class="mx-auto flex max-w-7xl items-center justify-between px-4 py-3"
			>
				<div class="text-sm font-semibold">Image Processing Engine</div>
				<div class="flex items-center gap-2">
					<button
						id="presets-button"
						class="rounded-xl border border-zinc-800 px-3 py-2 text-sm hover:bg-zinc-900"
					>
						Presets
					</button>
				</div>
			</div>
		</header>

		<main class="flex-1 min-h-0 mx-auto max-w-7xl px-4 py-6">
			<div class="grid h-[calc(100dvh-250px)] gap-6 lg:grid-cols-12">
				<!-- LEFT: Preview -->
				<section class="lg:col-span-7 h-full min-h-0 flex flex-col">
					<div
						class="rounded-2xl border border-zinc-800 bg-zinc-900/30 p-4"
					>
						<!-- top row -->
						<div class="mb-3 flex items-center justify-between">
							<div class="text-sm font-semibold text-zinc-200">
								Preview
							</div>
						</div>

						<!-- titles aligned with rail -->
						<div
							class="mb-3 grid grid-cols-[52px_1fr_1fr] items-center gap-4"
						>
							<div></div>
							<h2 class="text-sm font-semibold text-zinc-200">
								Original
							</h2>
							<h2 class="text-sm font-semibold text-zinc-200">
								Filtered
							</h2>
						</div>

						<div class="grid grid-cols-[52px_1fr] gap-4">
							<!-- rail -->
							<div class="flex flex-col items-center gap-3 pt-1">
								<button
									class="grid h-10 w-10 place-items-center rounded-xl border border-zinc-800 bg-zinc-950/50 text-lg hover:bg-zinc-900"
									id="upload-btn"
								>
									+
								</button>
								<button
									id="download-button"
									class="grid h-10 w-10 place-items-center rounded-xl border border-zinc-800 bg-zinc-950/50 hover:bg-zinc-900 transition-colors"
									title="Download ZIP"
								>
									<svg
										xmlns="http://www.w3.org/2000/svg"
										width="14"
										height="14"
										viewBox="0 0 24 24"
										fill="none"
										stroke="currentColor"
										stroke-width="2.5"
										stroke-linecap="round"
										stroke-linejoin="round"
										class="text-zinc-100"
									>
										<path
											d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"
										></path>
										<polyline
											points="7 10 12 15 17 10"
										></polyline>
										<line
											x1="12"
											x2="12"
											y1="15"
											y2="3"
										></line>
									</svg>
								</button>
								<button
									id="clear-images-button"
									class="grid h-10 w-10 place-items-center rounded-xl border border-zinc-800 bg-zinc-950/50 hover:bg-red-950/40 transition-colors"
									title="Clear all images"
								>
									<svg
										xmlns="http://www.w3.org/2000/svg"
										width="14"
										height="14"
										viewBox="0 0 24 24"
										fill="none"
										stroke="currentColor"
										stroke-width="2.5"
										stroke-linecap="round"
										stroke-linejoin="round"
										class="text-red-400"
									>
										<polyline
											points="3 6 5 6 21 6"
										></polyline>
										<path
											d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6"
										></path>
										<path d="M10 11v6"></path>
										<path d="M14 11v6"></path>
										<path
											d="M9 6V4a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2"
										></path>
									</svg>
								</button>
							</div>

							<!-- SHARED scroll container for rows -->
							<div
								class="h-[calc(100dvh-250px)] overflow-y-auto pr-2"
							>
								<div
									class="space-y-3"
									id="slot-rows-parent"
								></div>
							</div>
						</div>

						<div class="mt-3 text-xs text-zinc-500">
							Note: Images sometimes glitch in the preview. Once
							downloaded, they should display correctly.
						</div>
					</div>
				</section>

				<!-- Divider -->
				<div class="hidden lg:block lg:col-span-1 min-h-0">
					<div
						class="mx-auto h-[calc(100dvh-125px)] w-px bg-zinc-800"
					></div>
				</div>

				<!-- Right: Console -->
				<aside class="lg:col-span-4 min-h-0">
					<div
						class="flex flex-col rounded-2xl border border-zinc-800 bg-zinc-900/30 p-4 h-[calc(100dvh-125px)]"
					>
						<div class="mb-3 flex items-center justify-between">
							<div class="text-sm font-semibold text-zinc-200">
								Pipeline
							</div>
							<div class="flex items-center gap-2">
								<button
									class="grid h-10 w-10 place-items-center rounded-xl border border-zinc-800 hover:bg-zinc-900"
									id="json-help-button"
								>
									?
								</button>
							</div>
						</div>

						<div
							class="flex flex-1 flex-col min-h-0 rounded-2xl border border-zinc-800 bg-zinc-950"
						>
							<div
								class="flex items-center justify-between border-b border-zinc-800 px-3 py-2"
							>
								<span class="text-xs text-zinc-400"
									>pipeline.json</span
								>
							</div>
							<div
								id="json-editor-container"
								class="flex-1 min-h-0 w-full border border-zinc-800 bg-zinc-950/50 rounded-xl overflow-hidden font-mono text-[13px] antialiased"
							></div>
						</div>

						<div class="mt-4 flex items-center justify-between">
							<div class="text-xs text-zinc-500">
								Status:
								<span class="text-zinc-300" id="status-flag"
									>idle</span
								>
							</div>
							<button
								id="process-btn"
								class="rounded-xl bg-zinc-100 px-5 py-2 text-sm font-medium text-zinc-900 hover:bg-white disabled:bg-zinc-800 disabled:text-zinc-300 disabled:cursor-not-allowed"
							>
								Process
							</button>
						</div>
					</div>
				</aside>
			</div>
		</main>
		<script src="engine.js"></script>
		<script
			type="module"
			src="./file-processing/image-classes/PPMImage.js"
		></script>
		<script type="module" src="./ui/CanvasRow.js"></script>
		<script type="module" src="./main.js"></script>
		<script type="module" src="./ui/CanvasSlot.js"></script>
		<script
			type="module"
			src="./file-processing/FilesAdministrator.js"
		></script>
		<script type="module" src="./file-processing/paths.js"></script>
		<script type="module" src="./ui/setupJSONPipelineEditor.js"></script>
		<script src="./vendor/jszip.min.js"></script>
		<style>
			::-webkit-scrollbar {
				width: 11px;
				height: 13px;
			}
			::-webkit-scrollbar-track {
				background-color: #09090b;
				border-radius: 9999px;
				border: 2px solid transparent;
				background-clip: content-box;
			}
			::-webkit-scrollbar-thumb {
				background-color: #27272a;
				border-radius: 9999px;
				border: 2px solid transparent;
				background-clip: content-box;
			}
			::-webkit-scrollbar-thumb:hover {
				background-color: #3f3f46;
			}
			#pipeline-json-textarea::-webkit-scrollbar-thumb {
				background-color: #3f3f46;
				background-clip: content-box;
			}
		</style>
		<div
			id="image-modal"
			class="fixed inset-0 z-50 flex items-center justify-center bg-zinc-950/90 backdrop-blur-sm p-4 transition-all duration-300 ease-out opacity-0 pointer-events-none"
		>
			<div
				id="modal-container"
				class="relative transform transition-all duration-300 scale-90 opacity-0"
			>
				<canvas
					id="modal-canvas"
					class="max-w-full max-h-[85vh] shadow-2xl rounded-lg image-render-pixelated"
				></canvas>
				<div
					id="modal-caption"
					class="mt-4 text-center text-zinc-400 text-sm font-mono italic"
				></div>
			</div>
		</div>
		<div
			id="json-help-modal"
			class="hidden fixed inset-0 bg-zinc-950/90 backdrop-blur-sm z-50 flex items-center justify-center p-4 transition-all duration-200"
		>
			<div
				class="bg-zinc-950 border border-zinc-800 w-[640px] h-[640px] rounded-2xl flex flex-col shadow-2xl overflow-hidden"
			>
				<div
					class="flex border-b border-zinc-800 p-2 gap-2 bg-zinc-900/50 rounded-t-2xl"
				>
					<button
						id="btn-tab-filters"
						class="flex-1 py-2 px-4 rounded-xl font-semibold transition-colors bg-zinc-100 text-zinc-950 antialiased"
					>
						Filter Reference
					</button>
					<button
						id="btn-tab-schema"
						class="flex-1 py-2 px-4 rounded-xl font-semibold transition-colors text-zinc-400 hover:bg-zinc-800/50 antialiased"
					>
						JSON Schema
					</button>
					<button
						id="close-help-modal"
						class="px-4 text-zinc-500 hover:text-zinc-100 transition-colors focus:outline-none"
					>
						✕
					</button>
				</div>

				<div
					class="p-6 overflow-y-auto custom-scrollbar flex-1 text-[13px] leading-relaxed"
					style="scrollbar-gutter: stable"
				>
					<div id="content-tab-filters" class="space-y-6">
						<div
							class="flex items-center gap-3 text-zinc-500 animate-pulse"
						>
							<div class="h-2 w-2 rounded-full bg-zinc-700"></div>
							<span class="font-mono text-xs text-zinc-500"
								>Loading...</span
							>
						</div>
					</div>

					<div id="content-tab-schema" class="hidden space-y-5">
						<div
							class="rounded-xl border border-zinc-800 bg-zinc-900/20 p-4"
						>
							<h4
								class="text-zinc-200 font-semibold mb-2 flex items-center gap-2"
							>
								<span
									class="h-1 w-3 bg-cyan-500 rounded-full"
								></span>
								Pipeline Structure
							</h4>
							<pre
								class="font-mono text-cyan-400 leading-tight overflow-x-auto p-2"
							>
{
  "pipeline": [
    {
      "filter": "filter_name",
      "params": {
        "param1": "value1",
        "param2": "value2",
            .
            .
            .
      }
    }
  ],
  "statistics": {
    "histograms": {
      "histogramType1": (bool),
      "histogramType2": (bool),
            .
            .
            .
    }
  },
  "output_suffix": (string),
  "output_extension": (string) <= "auto" | "jpg" | "jpeg" | "png" | "ppm"
}
    </pre
							>
						</div>
						<p class="text-zinc-500 text-xs px-1 italic">
							Note: Visual histogram rendering is not supported in
							the web version. If enabled, raw statistical data
							will be included in JSON format within the processed
							output.
						</p>
					</div>
				</div>
			</div>
		</div>
		<input
			type="file"
			id="image-input"
			accept=".ppm, .jpg, .jpeg, .png, image/jpeg, image/png"
			multiple
			class="hidden"
		/>
		<div
			id="presets-modal"
			class="fixed inset-0 z-50 flex items-center justify-center bg-zinc-950/80 backdrop-blur-sm p-4 hidden"
		>
			<div
				class="w-full max-w-3xl rounded-2xl border border-zinc-800 bg-zinc-950 shadow-2xl overflow-hidden"
			>
				<!-- HEADER -->
				<div
					class="flex items-center justify-between border-b border-zinc-800 bg-zinc-900/30 p-4"
				>
					<h3 class="text-sm font-semibold text-zinc-100">Presets</h3>

					<div class="flex items-center gap-3">
						<!-- Tabs -->
						<div class="flex items-center gap-2">
							<button
								data-scope="builtin"
								class="px-3 py-1.5 text-xs rounded-md border border-zinc-700 text-zinc-400 hover:text-zinc-100 hover:border-zinc-500 hover:bg-zinc-800/40 transition preset-tabs-buttons"
								id="presets-builtin-button"
							>
								Built-in
							</button>

							<button
								data-scope="mine"
								class="px-3 py-1.5 text-xs rounded-md border border-zinc-700 text-zinc-400 hover:text-zinc-100 hover:border-zinc-500 hover:bg-zinc-800/40 transition preset-tabs-buttons"
								id="presets-mine-button"
							>
								My presets
							</button>

							<button
								data-scope="community"
								class="px-3 py-1.5 text-xs rounded-md border border-zinc-700 text-zinc-400 hover:text-zinc-100 hover:border-zinc-500 hover:bg-zinc-800/40 transition preset-tabs-buttons"
								id="presets-community-button"
							>
								Community
							</button>
						</div>

						<!-- Close -->
						<button
							id="close-presets"
							class="text-zinc-500 hover:text-zinc-100"
						>
							✕
						</button>
					</div>
				</div>

				<!-- FILTER BAR -->
				<div
					class="flex items-center gap-3 border-b border-zinc-800 bg-zinc-900/20 p-3 hidden"
					id="preset-filter-bar"
				>
					<!-- Search -->
					<input
						id="preset-search"
						type="text"
						placeholder="Search presets..."
						class="flex-1 rounded-lg bg-zinc-900 border border-zinc-700 px-3 py-2 text-sm text-zinc-100"
					/>

					<!-- Sort -->
					<select
						id="preset-sort"
						class="rounded-lg bg-zinc-900 border border-zinc-700 px-3 py-2 text-sm text-zinc-100"
					>
						<option value="newest">Newest</option>
						<option value="top">Most voted</option>
						<option value="az">A–Z</option>
					</select>
				</div>

				<!-- CONTENT -->
				<div
					id="preset-container"
					class="max-h-[60vh] overflow-y-auto p-4 grid grid-cols-1 gap-3"
				>
					<!-- cards -->
				</div>
			</div>
		</div>

		<div
			id="clear-images-modal"
			class="hidden fixed inset-0 z-50 flex items-center justify-center bg-zinc-950/80 backdrop-blur-sm p-4 transition-opacity duration-200"
			aria-hidden="true"
		>
			<div
				class="w-full max-w-md rounded-2xl border border-zinc-800 bg-zinc-950 shadow-2xl overflow-hidden transform transition-transform duration-200 scale-95"
				role="dialog"
				aria-modal="true"
				aria-labelledby="clear-images-title"
				aria-describedby="clear-images-desc"
			>
				<div
					class="flex items-center justify-between border-b border-zinc-800 bg-zinc-900/30 p-4"
				>
					<h3
						id="clear-images-title"
						class="text-sm font-semibold text-zinc-100"
					>
						Clear all images?
					</h3>
					<button
						id="close-clear-images"
						class="text-zinc-500 hover:text-zinc-100 transition-colors"
						aria-label="Close"
					>
						✕
					</button>
				</div>

				<div class="p-5">
					<p
						id="clear-images-desc"
						class="text-sm text-zinc-400 leading-relaxed"
					>
						This will permanently remove all loaded images from the
						workspace.
					</p>

					<div class="mt-5 flex items-center justify-end gap-2">
						<button
							id="cancel-clear-images"
							class="rounded-xl border border-zinc-800 px-4 py-2 text-sm text-zinc-200 hover:bg-zinc-900 transition-colors"
						>
							Cancel
						</button>

						<button
							id="confirm-clear-images"
							class="rounded-xl bg-red-500/90 px-4 py-2 text-sm font-semibold text-zinc-950 hover:bg-red-400 transition-colors"
						>
							Clear images
						</button>
					</div>
				</div>
			</div>
		</div>
	</body>
</html>
